# Домашнее задание к уроку 7. #
1. В Yandex-Cloud от выполнения первого дз у меня осталась виртуальная машина и установленный PostgreSQL 15.    
![Шаг4](/4_1_OldVM.jpg)  
1. Зашла на ВМ под пользователем postgres   
![Шаг4](/4_2_login.jpg)  
1. Создала новую базу данных testdb и зашла в созданную базу данных под пользователем postgres   
![Шаг4](/4_3_database.jpg)  
1. Создала новую схему testnm, затем новую таблицу t1 с одной колонкой c1 типа integer и вставила строку со значением c1=1   
![Шаг4](/4_4_table.jpg)  
1. Создала новую роль readonly, дала права на подключение к базе данных testdb, дала права на использование схемы testnm и права на select для всех таблиц схемы testnm   
![Шаг4](/4_5_role.jpg)  
1. Создала пользователя testread, дала ему роль readonly  и попробовала зайти под пользователем testread в базу данных testdb   
![Шаг4](/4_6_user.jpg)  
**Т.к. при выполнении первого ДЗ я не меняла никаких настроек в PostgreSQL, то попытка зайти под другим пользователем не удалась. Нужно сменить Peer authentication на авторизацию через пароль.**  
Полезла в конфигурационные файлы:   
![Шаг4](/4_7_pg_hba_conf.jpg)  
Поменяла метод аутентификации на md5:   
![Шаг4](/4_8_pg_hba_conf.jpg)   
Теперь я смогла подключиться к базе testdb с логином testread:   
![Шаг4](/4_9_ok_connect.jpg)   
1. Сделала select * from t1;   
![Шаг4](/4_9_no_permission.jpg)   
**Т.к. при создании таблицы t1 не указывалась явно схема, то таблица создалась по умолчанию в схеме public. Этот факт подтверждает список таблиц базы**   
![Шаг4](/4_10_tables_list.jpg)   
1.  Перешла в базу данных testdb под пользователем postgres, удалила таблицу t1, создала ее заново с явным указанием имени схемы testnm и вставила строку со значением c1=1   
![Шаг4](/4_11_new_table.jpg)   
1. Зашла под пользователем testread в базу данных testdb и сделала select * from testnm.t1;   
![Шаг4](/4_12_no_perm_2.jpg)   
**Т.к. права на таблицы схемы testnm выдавались командой grant select on all tables in schema testnm to readonly, то на вновь созданную таблицу testnm.t1 эта команда уже не действовала, таблица создана позднее**   
1. Для получения доступа к таблице testnm.t1 повторила команду выдачи прав, предварительно переподключившись от postgres:   
![Шаг4](/4_11_ok_select.jpg)   
**Подключилась к testdb как пользователь testread и наконец-то таблица testnm.t1 видна**   
1. Чтобы пользователю testread были доступны все вновь создаваемые таблицы в схеме testnm, нужно дать роли readonly привелегию по умолчанию на select всех таблиц:   
![Шаг4](/4_12_default_privs.jpg)   
Сделала select * from testnm.t1; Все работает.   
1. Попробовала выполнить команду create table t2(c1 integer);   
![Шаг4](/4_13_hahaha.jpg)   
**Вышла ошибка по недостатку прав на создание таблицы в схеме public. Как бы логично, т.к. роли readonly не давали прав на create table  в схеме public. Но по тексту дз явно ожидалось что-то другое. Слазила в шпаргалку, потом взяла помощь могучего Интернета. Тут и выяснилось, что до 15 версии PostgreSQL у обычного пользователя была привелегия создавать объекты в схеме public. А с 15 версии у псевдороли public на схему public только привилегия USAGE. Нужно было четко следовать инструкции и поставить вначале 14 версию... Но переделывать уже не стала.**   
